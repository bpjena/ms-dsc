dag:
  dag_args:
    dag_name: deng_jobs
    scheduler_interval: '@daily'
    description: "local_machine_runs_for_dag_tasks"
    image: 000000000001.dkr.ecr.us-east-1.amazonaws.com/deng-jobs:latest
  default_args:
    owner: Data Engineering
    retries: 2
    page_on_failure: {{ env.page_on_failure }}
    pager_address: pagerduty-xxxxxx-sumologic #TO-DO: pagerduty
    email_on_failure: {{ env.email_on_failure }}
    email:
      - bjena@sumologic.com
  tasks:
    - task_name: sumo_s3_to_redshift
      command: '/bin/bash -c "PYTHONPATH=. python python/s3_to_redshift/sumo_csv_import.py"'
    - task_name: sfdc_redshift_transform
      command: '/bin/bash -c "PYTHONPATH=. python python/redshift/sfdc_transforms.py"'
    - task_name: redshift_admin_utility_job
      command: '/bin/bash -c "PYTHONPATH=. python python/redshift/admin_user_utility.py"'
    - task_name: open_pipe
      command: '/bin/bash -c "PYTHONPATH=. python python/redshift/sfdc_open_pipe.py"'
    - task_name: sumo_raw
      command: '/bin/bash -c "PYTHONPATH=. python python/redshift/sumo_raw_tables.py"'

  execution_order:
    - s3_to_redshift_sfdc_json
  env:
    - REDSHIFT_USER
    - REDSHIFT_PASSWORD
    - CONFIG_ENV: {{ env.config_env }}
